# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ Pulse App

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 19 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 4.6.0

---

## üèóÔ∏è I. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### ‚úÖ –•–æ—Ä–æ—à–æ

1.  **Data Fetching Layer (TanStack Query + Supabase):**
    –≠—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Å–∏–ª—å–Ω–µ–π—à–∏—Ö —Å—Ç–æ—Ä–æ–Ω –ø—Ä–æ–µ–∫—Ç–∞. –°–≤—è–∑–∫–∞ `useQuery` / `useMutation` —Å `Supabase` ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.
    *   **Optimistic Updates:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `useUpdateTask.ts` (380 —Å—Ç—Ä–æ–∫!) ‚Äî —ç—Ç–æ —Å–µ—Ä—å–µ–∑–Ω–∞—è, –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è `parent_id`, `project_id`, `section_id` –∏ –¥–∞–∂–µ `is_completed` (–∫–æ—Ç–æ—Ä—ã–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ—Ö –¥–µ—Ç–µ–π) –ø–æ–∫—Ä—ã—Ç—ã. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–Ω—É–ª–µ–≤—É—é –∑–∞–¥–µ—Ä–∂–∫—É** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    *   **Cache Invalidation:** –ì—Ä–∞–º–æ—Ç–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–µ—à–∏ (`['tasks']`, `['all-tasks-v2']`, `['subtasks']`, `['task', id]`).
    *   **Query Persistence:** `PersistQueryClientProvider` –≤ `main.tsx` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `localStorage`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏ –¥–∞–∂–µ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è.

2.  **Recurrence Engine (`rrule`):**
    –í—ã–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `rrule` –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Google Calendar, Outlook). –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `recurrence.ts` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç:
    *   –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (`generateRecurringInstances`).
    *   –ò—Å–∫–ª—é—á–µ–Ω–∏—è (`addExDateToRRule`).
    *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Å–µ—Ä–∏–∏ (`updateDTStartInRRule`).
    *   –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–µ—Ä–∏–∏ (`addUntilToRRule`).
    *   –ü—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ (`getPastIncompleteInstances`).
    –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–∏, –ø—Ä–æ–ø—É—Å–∫ –µ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∞).

3.  **State Management:**
    *   **Zustand (`useSettings`):** –î–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –≤—ã–±–æ—Ä. Store —Å–æ–¥–µ—Ä–∂–∏—Ç `debounced` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å Supabase. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –∞ —Å–µ—Ç—å –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–∞—Å—Ç—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏.
    *   **React Query:** –î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
    *   **URL State (`useSearchParams`):** –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –≤—ã–±–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É.

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã / –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1.  **"God Objects" (–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã):**
    *   `TaskItem.tsx` (730 —Å—Ç—Ä–æ–∫) ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:
        *   –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á–∏.
        *   Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞.
        *   –°–≤–∞–π–ø—ã (`Framer Motion`).
        *   –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é.
        *   –õ–æ–≥–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—Ç—ã.
        *   –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —É–¥–∞–ª–µ–Ω–∏—è.
        *   –õ–æ–≥–∏–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`useTaskCompletion`).
        *   –õ–æ–≥–∏–∫—É Drag-and-Drop (`dnd-kit`).
    *   `TaskDetail.tsx` (795 —Å—Ç—Ä–æ–∫) ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞.
    *   **–†–∏—Å–∫:** –í—ã—Å–æ–∫–∞—è –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞. –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤—Å–µ–≥–æ —Ñ–∞–π–ª–∞. –õ–µ–≥–∫–æ –≤–Ω–µ—Å—Ç–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏—é.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–∞–∑–±–∏—Ç—å –Ω–∞:
        *   `TaskItemContent.tsx` (—Ç–æ–ª—å–∫–æ UI).
        *   `TaskItemSwipeActions.tsx` (–ª–æ–≥–∏–∫–∞ —Å–≤–∞–π–ø–æ–≤).
        *   `useTaskItemActions.ts` (—Ö—É–∫ —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π).

2.  **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏:**
    *   `TaskItem.tsx` –∏ `TaskDetail.tsx` –∏–º–µ—é—Ç –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è:
        *   `toggleStatus` / `handleToggleStatus`.
        *   `recurrenceEditModalOpen` / `setRecurrenceEditModalOpen` / `allowedModes` / `pendingDateUpdate`.
        *   `handleRecurrenceUpdateConfirm`.
    *   –≠—Ç–æ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–µ–Ω–æ —Ö—É–∫–æ–º `useTaskRecurrenceLogic` –¥–ª—è `TaskDetail`, –Ω–æ `TaskItem` –¥—É–±–ª–∏—Ä—É–µ—Ç –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å —ç—Ç–æ–≥–æ –∫–æ–¥–∞ –≤—Ä—É—á–Ω—É—é.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–∞—Å—à–∏—Ä–∏—Ç—å `useTaskRecurrenceLogic` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å `useTaskActions` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

3.  **–ü—Ä–æ–ø-–¥—Ä–∏–ª–ª–∏–Ω–≥ (Prop Drilling):**
    *   `occurrencesMap`, `viewMode`, `disableStrikethrough`, `isSubtaskMode`, `isDraggingOverlay`, `isMobile` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤–Ω–∏–∑ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `React.Context` –¥–ª—è `viewMode`, `isMobile`, `occurrencesMap`.

---

## ‚ö° II. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –•–æ—Ä–æ—à–æ

1.  **`React.memo`:** `TaskItem` –æ–±–µ—Ä–Ω—É—Ç –≤ `memo`, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏.
2.  **`useMemo` –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è:** `events` –≤ `DailyPlanner.tsx` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `useMemo`, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ.
3.  **`keepPreviousData` (Placeholder Data):** –í `useTasks` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `placeholderData: keepPreviousData`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –±–µ—Å—à–æ–≤–Ω—ã–º (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è, –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ).

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1.  **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (Client-side Filtering):**
    *   –í `useTasks` (—Å—Ç—Ä–æ–∫–∞ 130-147) –¥–ª—è –≤–∏–¥–æ–≤ "Today/Tomorrow" —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–¥–∞—á, –∞ –ø–æ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
    *   –í `useTasks` (—Å—Ç—Ä–æ–∫–∞ 158-162) —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `tags` –¥–ª—è "Completed" view –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ fetch.
    *   **–†–∏—Å–∫:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö (10k+ –∑–∞–¥–∞—á) —ç—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –≤–∏–¥–∏–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Supabase RPC (—Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤, –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–Ω–µ—Ç —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º.

2.  **N+1 Query Problem (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ):**
    *   `useTaskView.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `organizeByHierarchy`, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è. –≠—Ç–æ `O(n*m)` –æ–ø–µ—Ä–∞—Ü–∏—è.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–∏ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–∞—Ö –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å `children` –æ–¥–∏–Ω —Ä–∞–∑ –≤ `Map<parent_id, Task[]>`.

3.  **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–æ–≤:**
    *   `ProjectTasks` –∏ –¥—Ä—É–≥–∏–µ –≤–∏–¥—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤ DOM.
    *   **–†–∏—Å–∫:** –ü—Ä–∏ 500+ –≤–∏–¥–∏–º—ã—Ö –∑–∞–¥–∞—á –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏—Ç–æ—Ä–º–∞–∂–∏–≤–∞—Ç—å.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `react-window` –∏–ª–∏ `@tanstack/react-virtual` –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤.

---

## üõ°Ô∏è III. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### ‚úÖ –•–æ—Ä–æ—à–æ

1.  **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∑–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤:**
    *   `ProtectedRoute.tsx` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –∏ —Å–ª—É—à–∞–µ—Ç `onAuthStateChange`.
    *   `enabled: !!user` –≤ `useTasks` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

2.  **–û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
    *   `useUpdateTask.ts` –≤ `onError` –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–µ—à–∏ –∏–∑ —Å–Ω–∏–º–∫–æ–≤ (`previousTask`, `previousAllTasks`, `modifiedLists`).

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1.  **–¢–∏–ø–∏–∑–∞—Ü–∏—è `any` (~40+ —Ñ–∞–π–ª–æ–≤):**
    *   –ü—Ä–∏–º–µ—Ä—ã:
        *   `useTasks.ts:127`: `let finalData = initialData as any[]`
        *   `useUpdateTask.ts:81`: `const cascadeUpdates: any = {}`
        *   `DailyPlanner.tsx:42`: `setPendingCalendarUpdate<any>(null)`
        *   `TaskItem.tsx:576`: `{task.tags.map((tag: any) => ...)}`
    *   **–†–∏—Å–∫:** –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –ø—Ä–æ—è–≤—è—Ç—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –∫–∞–∫ –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω (`undefined is not a function`).
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):**
        1.  –°–æ–∑–¥–∞—Ç—å `types/tasks.ts` —Å –ø–æ–ª–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ (`TaskWithOccurrence`, `CalendarEvent`).
        2.  –í–∫–ª—é—á–∏—Ç—å `strict: true` –∏ `noImplicitAny: true` –≤ `tsconfig.json` –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —á–∏–Ω–∏—Ç—å –æ—à–∏–±–∫–∏.

2.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API:**
    *   –í `useTasks.ts:125`: `if (error) throw error` ‚Äî –Ω–æ –Ω–∏–≥–¥–µ –≤—ã—à–µ –Ω–µ—Ç `ErrorBoundary` –¥–ª—è –æ—Ç–ª–æ–≤–∞ —ç—Ç–æ–π –æ—à–∏–±–∫–∏ –≤ UI.
    *   –í `useSettings.ts:60`: `console.error('Error syncing settings:', error)` ‚Äî –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
        *   –î–æ–±–∞–≤–∏—Ç—å React `ErrorBoundary` –Ω–∞ —É—Ä–æ–≤–Ω–µ `Layout`.
        *   –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å `toast.error(...)` –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

3.  **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (Race Conditions):**
    *   `TaskDetail.tsx` (—Å—Ç—Ä–æ–∫–∞ 173-214) `createTaskIfNeeded` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–ª–∞–≥–∏ (`isCreatingRef`, `hasCreatedRef`) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —è–≤–ª—è–µ—Ç—Å—è –º–∞–≥–∞–∑–∏–Ω–æ–º –∫–æ—Å—Ç—ã–ª–µ–π.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useMutation` —Å `isPending` –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω—ã—Ö —Ä–µ—Ñ–æ–≤.

---

## üîê IV. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –•–æ—Ä–æ—à–æ

1.  **Supabase RLS (Row Level Security):**
    *   –ó–∞–ø—Ä–æ—Å—ã –∫ `tasks`, `user_settings` –∏ —Ç.–¥. –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä—É—á–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ `user_id`. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ **–¥–æ—Å—Ç—É–ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (Supabase Policies), —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ª—É—á—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π.

2.  **–°–µ–∫—Ä–µ—Ç—ã –≤ `.env`:**
    *   `supabase.ts` —á–∏—Ç–∞–µ—Ç `import.meta.env.VITE_SUPABASE_URL` –∏ `VITE_SUPABASE_ANON_KEY`. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫—É –∫–ª—é—á–µ–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1.  **OpenAI API Key –≤ `preferences`:**
    *   `database.ts:97`: `openai_api_key?: string` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `UserSettings.preferences`.
    *   **–†–∏—Å–∫:** –ö–ª—é—á OpenAI –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∏–¥–µ–Ω –≤ `localStorage` (—á–µ—Ä–µ–∑ `QueryClient` persistence) –∏ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ Supabase (–µ—Å–ª–∏ `select('*')`).
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –•—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Supabase Edge Function) –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å AI-–∑–∞–ø—Ä–æ—Å—ã. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª—é—á –Ω–∞ –∫–ª–∏–µ–Ω—Ç.

---

## üßπ V. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å (Maintainability)

### ‚úÖ –•–æ—Ä–æ—à–æ

1.  **–ê–ª–∏–∞—Å—ã –ø—É—Ç–µ–π (`@/`):**
    *   `vite.config.ts:45`: `alias: { "@": path.resolve(__dirname, "./src") }` ‚Äî —É–ø—Ä–æ—â–∞–µ—Ç –∏–º–ø–æ—Ä—Ç—ã –∏ –¥–µ–ª–∞–µ—Ç –∏—Ö —á–∏—Ç–∞–µ–º—ã–º–∏.

2.  **–õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫:**
    *   `features/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞.
    *   `hooks/` ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ö—É–∫–∏.
    *   `pages/` ‚Äî —Ä–æ—É—Ç—ã.
    *   `components/ui/` ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI-—ç–ª–µ–º–µ–Ω—Ç—ã.

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1.  **–ò–º–ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π:**
    *   `useTaskCompletion.ts:152`: `const { data } = await import('@/lib/supabase').then(...)` ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ `fetch` callback. –≠—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É –∏ –Ω–µ –¥–∞–µ—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ code-splitting (—Ñ–∞–π–ª —É–∂–µ –≤ –±–∞–Ω–¥–ª–µ).
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–æ—Å–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞.

2.  **–°–º–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ –ª–æ–≥–∏–∫–∏:**
    *   `useSettings.ts:22-43`: `DEFAULT_SETTINGS` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ Store. –õ—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ `constants/settings.ts`.

3.  **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤:**
    *   –ù–µ—Ç –ø–∞–ø–∫–∏ `__tests__` –∏–ª–∏ `*.test.ts` —Ñ–∞–π–ª–æ–≤.
    *   **–†–∏—Å–∫:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `recurrence.ts` –∏–ª–∏ `useUpdateTask.ts` –ª–µ–≥–∫–æ –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è.
    *   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç):** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è:
        *   `generateRecurringInstances`
        *   `getPastIncompleteInstances`
        *   –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ `useUpdateTask`

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –¢–∞–±–ª–∏—Ü–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---|---|---|
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | –°–∏–ª—å–Ω—ã–π data layer, –Ω–æ God Objects —Ç—Ä–µ–±—É—é—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | –û—Ç–ª–∏—á–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ | –û—Ç–∫–∞—Ç –æ—à–∏–±–æ–∫ –µ—Å—Ç—å, –Ω–æ `any` –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ErrorBoundary ‚Äî —Ä–∏—Å–∫ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ | RLS –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ DB ‚Äî –ø–ª—é—Å, –Ω–æ —Ö—Ä–∞–Ω–µ–Ω–∏–µ OpenAI –∫–ª—é—á–∞ ‚Äî –º–∏–Ω—É—Å |
| **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ | –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫, –Ω–æ –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ –∏ –º–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è |

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### 1. –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–µ–π—á–∞—Å)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π `<ErrorBoundary>` –≤ `App.tsx`
- [ ] –£–±—Ä–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ `openai_api_key` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### 2. –í–∞–∂–Ω–æ (—ç—Ç–æ—Ç —Å–ø—Ä–∏–Ω—Ç)
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `TaskItem.tsx` (—Ä–∞–∑–±–∏—Ç—å –Ω–∞ 3+ —Ñ–∞–π–ª–∞)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `any` –Ω–∞ —Ç–∏–ø—ã –≤ —Ö–æ—Ç—è –±—ã `useTasks.ts`, `useUpdateTask.ts`, `DailyPlanner.tsx`

### 3. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (—Å–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –∑–∞–¥–∞—á (`react-window`)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è `recurrence.ts`

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è          | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                            |
| ------------------ | ------------------------------------- |
| Frontend Framework | React 18                              |
| Build Tool         | Vite 7                                |
| Language           | TypeScript 5.9                        |
| Styling            | Tailwind CSS 4                        |
| State Management   | Zustand, TanStack Query               |
| Backend            | Supabase (PostgreSQL, Auth, Realtime) |
| Calendar           | FullCalendar                          |
| Animation          | Framer Motion                         |
| Drag-and-Drop      | @dnd-kit                              |
| Recurrence         | rrule                                 |
| Mobile             | Capacitor (Android)                   |
| PWA                | vite-plugin-pwa                       |

